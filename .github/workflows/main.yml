name: Deploy
on:
  push:
    branches:
      - main
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Configure AWS Credential
      uses: unfor19/install-aws-cli-action@v1
      
    - run: |     
        CREDENTIALS=$(aws sts assume-role --role-arn arn:aws:iam::031409194969:user/s3role --role-session-name s3role --duration-seconds 900)
        export AWS_ACCESS_KEY_ID="$(echo ${CREDENTIALS} | jq -r '.Credentials.AccessKeyId')"
        export AWS_SECRET_ACCESS_KEY="$(echo ${CREDENTIALS} | jq -r '.Credentials.SecretAccessKey')"
        export AWS_SESSION_TOKEN="$(echo ${CREDENTIALS} | jq -r '.Credentials.SessionToken')"
        export AWS_EXPIRATION=$(echo ${CREDENTIALS} | jq -r '.Credentials.Expiration')
    - name: Deploy static site to S3 bucket
      run: aws s3 sync ./public/ s3://elasticbeanstalk-ap-south-1-031409194969
  
